---
title: java虚拟机笔记(1) java内存区域
date: 2016-04-08 22:14:37
tags: 
 - java 
 - java虚拟机
categories: java

---

## 运行时数据区域

java虚拟机在执行java程序的过程中会把它所管理的内存划分为若干个不同的数据区域。


{% asset_img memory.jpg This is an example image %}

### 程序计数器
程序计数器是一个较小的内存空间，当前线程的字节码指示器，工作时通过改变这个计数器的值选取下一条需要执行的字节码指令

每隔线程都需要一个独立的程序计数器，各线程互不影响，这块内存为**线程私有内存**

此区域是唯一一在java虚拟机规范中没有规定任何OOM情况的区域

### java虚拟机栈
线程私有，生命周期与线程相同。每个方法在执行时都会创建一个栈帧(Stack Frame),用于存储局部变量表，操作数栈，动态链接，方法出口等信息。每个方法调用到执行完成的过程对应这一个栈帧在虚拟机栈中入栈到出栈。

局部变量表里存放了编译期可知的各种基本数据类型(boolean byte char short int float double long)还有对象引用(reference)

当进入一个方法时，这个方法需要在帧中分配多大的局部空间是完全确定的，在方法运行期间不会改变局部变量表的大小。

在java虚拟机规范中，如果线程请求栈深度大于虚拟机允许的深度，将抛出StackOverFlow异常，无法申请到足够内存，将会抛出OutOfMemory异常。

### 本地方法栈
和虚拟机栈功能十分相似，虚拟机栈为执行java方法服务，本地方法栈则为虚拟机使用到的native方法服务。与虚拟机栈一样，会抛出栈溢出和OOM错误。

### java堆
java虚拟机中管理内存最大的一块，被所有线程共享。此区唯一的目的就是存放对象实例，几乎所有实例对象和数组都在这里分配内存。

java堆是垃圾收集器管理的主要区域。从内存分配的角度看，还可能分出线程私有的分配缓冲区。java堆可以分配在物理上不连续的内存空间中，但逻辑上是连续的。当堆再也无法扩展时，抛出OOM异常。

### 方法区
和堆一样是各个线程共享去内存区域。用以存储虚拟机加载的类信息，常量，静态变量，即时编译器编译后的代码数据。有个别名为Non-Heap

方法区无法满足内存分配时也会抛出OOM

方法区中有一部分为运行时常量池，用于存放编译器生成的各种字面量和符号引用。

>以上笔记均摘抄自*深入理解java虚拟机-jvm高级特性与最佳实践* 
>
>这是一本非常棒的书，值得一看